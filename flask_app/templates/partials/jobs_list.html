{% if jobs %}
<div id="jobs-list" class="space-y-4">
    {% for job in jobs %}
    <div data-job-id="{{ job.id }}" class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
        <!-- Job Header -->
        <div class="flex justify-between items-start mb-4">
            <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                    <h3 class="text-xl font-bold">{{ job.name }}</h3>
                    <span class="status-badge px-3 py-1 rounded-full text-sm font-semibold
                        {% if job.status == 'pending' %}bg-gray-200 text-gray-700
                        {% elif job.status == 'running' %}bg-blue-100 text-blue-700
                        {% elif job.status == 'paused' %}bg-yellow-100 text-yellow-700
                        {% elif job.status == 'completed' %}bg-green-100 text-green-700
                        {% elif job.status == 'failed' %}bg-red-100 text-red-700
                        {% endif %}">
                        {{ job.status }}
                    </span>
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs font-mono">
                        {{ job.type }}
                    </span>
                    {% if job.settings.delete_source_after %}
                    <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">
                        üóëÔ∏è Deletion Enabled
                    </span>
                    {% endif %}
                </div>
                <p class="text-sm text-gray-600">
                    <span class="font-semibold">Source:</span> {{ job.source }}
                </p>
                <p class="text-sm text-gray-600">
                    <span class="font-semibold">Destination:</span> {{ job.dest }}
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-2 ml-4">
                {% if job.status in ['pending', 'paused', 'failed'] %}
                <button hx-post="/jobs/{{ job.id }}/start"
                        hx-target="#jobs-content"
                        hx-swap="outerHTML"
                        class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm">
                    ‚ñ∂ Start
                </button>
                {% elif job.status == 'running' %}
                <button hx-post="/jobs/{{ job.id }}/pause"
                        hx-target="#jobs-content"
                        hx-swap="outerHTML"
                        class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition text-sm">
                    ‚è∏ Pause
                </button>
                {% endif %}

                {% if job.status != 'running' %}
                <button hx-delete="/jobs/{{ job.id }}/delete"
                        hx-target="#jobs-content"
                        hx-swap="outerHTML"
                        hx-confirm="Are you sure you want to delete this job? This cannot be undone."
                        class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm">
                    üóë Delete
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Progress Bar (only for running/paused jobs with progress) -->
        {% if job.status in ['running', 'paused'] or job.progress.percent > 0 %}
        <div class="mb-4">
            <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span class="transfer-info">
                    {{ (job.progress.bytes_transferred / 1024 / 1024) | round(2) }} MB / {{ (job.progress.total_bytes / 1024 / 1024) | round(2) }} MB
                </span>
                <span class="font-semibold">{{ job.progress.percent }}%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                <div class="progress-bar bg-blue-600 h-4 rounded-full transition-all duration-500 flex items-center justify-center text-xs text-white font-semibold"
                     style="width: {{ job.progress.percent }}%">
                    {% if job.progress.percent > 10 %}{{ job.progress.percent }}%{% endif %}
                </div>
            </div>
        </div>

        <!-- Transfer Stats (only for running jobs) -->
        {% if job.status == 'running' %}
        <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
                <span class="text-gray-600">Speed:</span>
                <span class="speed-info font-semibold ml-1">
                    {{ (job.progress.speed_bytes / 1024) | round(2) }} KB/s
                </span>
            </div>
            <div>
                <span class="text-gray-600 eta-info">
                    ETA: {% if job.progress.eta_seconds > 0 %}{{ (job.progress.eta_seconds / 60) | round(1) }} min{% else %}calculating...{% endif %}
                </span>
            </div>
        </div>

        <!-- Deletion Progress (if deletion is active) -->
        {% if job.progress.deletion and job.progress.deletion.enabled %}
        <div class="deletion-progress mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
            <div class="text-sm">
                <span class="font-semibold text-yellow-900">Deletion Phase:</span>
                <span class="deletion-phase-text">
                {% if job.progress.deletion.phase == 'transfer' %}
                    <span class="text-yellow-700">Transferring files...</span>
                {% elif job.progress.deletion.phase == 'verifying' %}
                    <span class="text-blue-700">üîç Verifying backup integrity...</span>
                {% elif job.progress.deletion.phase == 'deleting' %}
                    <span class="text-red-700">üóëÔ∏è Deleting source files... (<span class="deletion-files-count">{{ job.progress.deletion.files_deleted }}</span> files, <span class="deletion-bytes-count">{{ (job.progress.deletion.bytes_deleted / 1024 / 1024) | round(2) }}</span> MB)</span>
                {% elif job.progress.deletion.phase == 'completed' %}
                    <span class="text-green-700">‚úÖ Deletion completed (<span class="deletion-files-count">{{ job.progress.deletion.files_deleted }}</span> files deleted)</span>
                {% elif job.progress.deletion.phase == 'failed' %}
                    <span class="text-red-700">‚ùå Deletion failed</span>
                {% endif %}
                </span>
            </div>
        </div>
        {% endif %}
        {% endif %}
        {% endif %}

        <!-- Job Settings Info -->
        <div class="mt-4 pt-4 border-t border-gray-200">
            <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                <div>
                    <span class="font-semibold">Bandwidth Limit:</span>
                    {% if job.settings.bandwidth_limit %}
                        {{ job.settings.bandwidth_limit }} KB/s
                    {% else %}
                        Unlimited
                    {% endif %}
                </div>
                <div>
                    <span class="font-semibold">Created:</span>
                    {{ job.created_at[:10] }}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div id="jobs-list" class="text-center py-12 bg-white rounded-lg shadow">
    <div class="text-gray-400 mb-4">
        <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No backup jobs yet</h3>
    <p class="text-gray-500 mb-4">Create your first backup job to get started</p>
    <button onclick="document.getElementById('create-job-modal').classList.remove('hidden')"
            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
        + Create New Job
    </button>
</div>
{% endif %}

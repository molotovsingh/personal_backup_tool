{% extends "base.html" %}

{% block title %}Settings - Backup Manager{% endblock %}

{% block content %}
<div class="max-w-4xl">
    <h1 class="text-3xl font-bold mb-6">Settings</h1>

    <!-- Flash Messages Container (HTMX will swap here) -->
    <div id="flash-messages" class="mb-4">
        {% include 'partials/flash_messages.html' %}
    </div>

    <!-- Settings Form -->
    <div class="bg-white rounded-lg shadow">
        <div class="p-6">
            <h2 class="text-xl font-semibold mb-4">Application Settings</h2>

            <form id="settings-form"
                  hx-post="/settings/save"
                  hx-target="#flash-messages"
                  hx-swap="innerHTML">

                {% include 'partials/settings_form.html' %}

                <!-- Form Actions -->
                <div class="flex gap-4 pt-6 border-t">
                    <button type="submit"
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                        Save Settings
                    </button>

                    <button type="button"
                            hx-post="/settings/reset"
                            hx-target="#settings-form-fields"
                            hx-swap="outerHTML"
                            hx-confirm="Are you sure you want to reset all settings to defaults?"
                            class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition">
                        Reset to Defaults
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- System Information -->
    <div class="bg-white rounded-lg shadow mt-6">
        <div class="p-6">
            <h2 class="text-xl font-semibold mb-4">System Information</h2>

            <div class="space-y-3">
                <div class="flex justify-between py-2 border-b">
                    <span class="font-medium text-gray-700">Jobs Storage:</span>
                    <span class="text-gray-600 font-mono text-sm">{{ system_info.jobs_file }}</span>
                </div>

                <div class="flex justify-between py-2 border-b">
                    <span class="font-medium text-gray-700">Settings Storage:</span>
                    <span class="text-gray-600 font-mono text-sm">{{ system_info.settings_file }}</span>
                </div>

                <div class="flex justify-between py-2 border-b">
                    <span class="font-medium text-gray-700">Logs Directory:</span>
                    <span class="text-gray-600 font-mono text-sm">{{ system_info.logs_dir }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tool Check -->
    <div class="bg-white rounded-lg shadow mt-6">
        <div class="p-6">
            <h2 class="text-xl font-semibold mb-4">Installed Tools</h2>

            <div class="space-y-3">
                <!-- rsync -->
                <div class="flex items-center justify-between py-2 border-b">
                    <div>
                        <span class="font-medium text-gray-700">rsync</span>
                        <p class="text-sm text-gray-500">Required for local/network backups</p>
                    </div>
                    <div class="text-right">
                        {% if rsync_installed %}
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                ✓ Installed
                            </span>
                        {% else %}
                            <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">
                                ✗ Not Found
                            </span>
                            <p class="text-xs text-gray-500 mt-1">Usually pre-installed on macOS/Linux</p>
                        {% endif %}
                    </div>
                </div>

                <!-- rclone -->
                <div class="flex items-center justify-between py-2 border-b">
                    <div>
                        <span class="font-medium text-gray-700">rclone</span>
                        <p class="text-sm text-gray-500">Required for cloud backups (Google Drive, etc.)</p>
                    </div>
                    <div class="text-right">
                        {% if rclone_installed %}
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                ✓ Installed
                            </span>
                            {% if rclone_version %}
                                <p class="text-xs text-gray-500 mt-1">Version: {{ rclone_version }}</p>
                            {% endif %}
                        {% else %}
                            <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">
                                ✗ Not Found
                            </span>
                            <p class="text-xs text-gray-500 mt-1">Install: <code class="bg-gray-100 px-1">brew install rclone</code></p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
